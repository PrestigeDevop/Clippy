<html>
<head>
    <link rel="stylesheet" type="text/css" href="./clippy.css" media="all">
    <style>
        html {
            background: url('http://wallpapercave.com/wp/7VNksl0.jpg') no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }
    </style>
    <script src="https://unpkg.com/jquery@3.2.1"></script>
    <script src="./main.js"></script>
    <script src="./agent.js"></script>
   <!-- <script src="./demo.js"></script>-->

    <!-- options with icons-->
    <script type="text/javascript" src="iconselect.js"></script>
    <script type="text/javascript" src="iscroll.js"></script>
    <!-- <script src="./bundle.js"></script> -->
    <!--#double agent-->  
</head>
<body>
  <h1>AI Agent</h1>
  <button id="button" onclick="myfunction()"> Remove Agent/s</button>
  <input list="agent" name="BOT" id="BOT"  onchange="UpdateAgent()">
  <datalist id="agent">
    <option value="Clippy">
    <option value="Rover">
    <option value="Bonzi">
    <option value="F1">
    <option value="Genie">
    <option value="Genius">
    <option value="Rocky">
   <option value="Peedy">
   <option value="Merlin">
   <option value="Links">
 
  </datalist>
  <div id="avatar"> text: @</div>
  <div id="my-icon-select"></div>
  <div id="dragable">
    <div class="dragpanel"id="dragableheader">Control Panel</div>
    <textarea id="QAS">give me a Random fact</textarea>
    <p>Move</p>
    <p>this</p>
    <p>DIV</p>  
    <button onclick="paneloptions()">clicker</button>
  
  </div>
    <script type="text/javascript">
     var iconSelect;
     var selectedText;
     var golbalthis_agent;
     var clippymanger= window.clippy;
     //console.log(`${clippymanger} loaded`)
     //console.log(clippymanger)
      window.onload = function(){
        iconSelect = new IconSelect("my-icon-select", 
                {'selectedIconWidth':70,
                'selectedIconHeight':70,
                'selectedBoxPadding':1,
                'iconsWidth':100,
                'iconsHeight':100,
                'boxIconSpace':1,
                'vectoralIconNumber':4,
                'horizontalIconNumber':4});
             var icons = [];
            icons.push({'iconFilePath':'images/icons/1.png', 'iconValue':'1',Agent_name:'Clippy'});
            icons.push({'iconFilePath':'images/icons/2.png', 'iconValue':'2',Agent_name:'Rover'});
            icons.push({'iconFilePath':'images/icons/3.png', 'iconValue':'3',Agent_name:'Bonzi'});
            icons.push({'iconFilePath':'images/icons/4.png', 'iconValue':'4',Agent_name:'F1'});
            icons.push({'iconFilePath':'images/icons/5.png', 'iconValue':'5',Agent_name:'Genie'});
            icons.push({'iconFilePath':'images/icons/6.png', 'iconValue':'6',Agent_name:'Genius'});
            icons.push({'iconFilePath':'images/icons/7.png', 'iconValue':'7',Agent_name:'Rocky'});
            icons.push({'iconFilePath':'images/icons/8.png', 'iconValue':'8',Agent_name:'Peedy'});
            icons.push({'iconFilePath':'images/icons/9.png', 'iconValue':'9',Agent_name:'Merlin'});
            icons.push({'iconFilePath':'images/icons/10.png', 'iconValue':'10',Agent_name:'Links'});
            
            // to do : add paths for each element
            console.log(icons[0].Agent_name)
            iconSelect.refresh(icons);
            selectedText= icons[iconSelect.getSelectedValue()]
            //console.log(selectedText.Agent_name)
           window.agentmanger=icons;
            // set up pesedu event listeners for the icons selected 
            //load icons
            window.activeagent ="Clippy"
            golbalthis_agent="Clippy"
            //console.log(window.activeagent)
            //console.log(window.agentmanger)
          //console.log(window.agentmanger[0].Agent_name)
            
        };
    
    function UpdateAgent(agent_name){
            var val = document.getElementById("BOT").value;

            var val = agent_name// try to find the chosen agent      
           // console.log(iconSelect.getSelectedValue()); //selected index
          
            console.log(`the agent ${val} at your service`)
            clippy.load(`${val}`, function(agent){
              agent.show();
              agent.speak(`i'm ${val} at your service`)
              //console.log(agent);// Agent manger
              globalThis.acctivebot=agent;
             golbalthis_agent=agent;
             //console.log(golbalthis_agent);
             //golbalthis_agent.speak("")
              return golbalthis_agent
            })
         }
        
         var agent = "Clippy"
          clippy.load('Clippy', function(agent){
        //     // init 
            agent.show();
            
            agent.speak("Hello, I'm Clippy your Good old friend powered by chat GPT!");
            agent.speak("كيف يمكنني مساعدتك؟");
             console.log(agent);// Agent manger
            golbalthis_agent=agent;

         });
             function myfunction(){ 
           console.log("Asking AIENDPOINT");
           //test  to remove all agents but leave the selected one
           var list = document.getElementsByClassName("Clippy");
            for (let item of list) {
           // console.log(item);
            item.remove();}
        }
        globalThis.window.CLIPPY_CDN ='agent' //folderprefixname +_agent name
        
  function paneloptions(){
    //console.log("TEST")
    var q = document.getElementById("QAS");
    console.log(`the query string is ${q.value}`)

const activebotfound = new CustomEvent("botfound", {
  detail: {
   constrctor () {
    //UpdateAgent("Clippy"),
    console.log("Agent update triggered")
   }, 
    name: golbalthis_agent.path,
    ID:selectedText,//agent ID
    agent:golbalthis_agent//agent variable
  },
});
// add an appropriate event listener
var place = document.getElementById("avatar");
place.addEventListener("botfound", (e) => 
e.detail.constrctor()
);
place.addEventListener('botfound', function(e){
  console.log("the bot updated ");  
   //nextAgent()
   var tag= document.getElementsByClassName("selected-icon")[0].children;
   console.log(tag);
   tag.onchange = function(){
    
    console.log(` test : ${tag.value} has been changed the id is ${e.detail}`); 
   }
              document.getElementById("avatar").innerHTML=`the agent is ${selectedText} ID:  ${iconSelect.getSelectedValue()} and the name is ${golbalthis_agent.path}`;
               //change it (the second string literal) to the name of the agent 
               //ping

            });

// dispatch the events

place.dispatchEvent(activebotfound);

// "cat" and "dog" logged in the console
 }
 // catch on document...
 document.addEventListener("hello", function(event) { // (1)
    alert("Hello from " + event.target.tagName); // Hello from H1
  });
  let event = new Event("hello", {bubbles: true}); // (2)
        </script>


<script>
    //Make the DIV element draggagle:
dragElement(document.getElementById("dragable"));

function dragElement(elmnt) {
  var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  if (document.getElementById(elmnt.id + "header")) {
    /* if present, the header is where you move the DIV from:*/
    document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
  } else {
    /* otherwise, move the DIV from anywhere inside the DIV:*/
    elmnt.onmousedown = dragMouseDown;
  }

  function dragMouseDown(e) {
    e = e || window.event;
    e.preventDefault();
    // get the mouse cursor position at startup:
    pos3 = e.clientX;
    pos4 = e.clientY;
    document.onmouseup = closeDragElement;
    // call a function whenever the cursor moves:
    document.onmousemove = elementDrag;
  }

  function elementDrag(e) {
    e = e || window.event;
    e.preventDefault();
    // calculate the new cursor position:
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;
    // set the element's new position:
    elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  }

  function closeDragElement() {
    /* stop moving when mouse button is released:*/
    document.onmouseup = null;
    document.onmousemove = null;
  }
}
  
 
  </script>
</body>
</html>